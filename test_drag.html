<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title></title>
<link type="text/css" rel="stylesheet" href="css/cssreset.css" />
<link type="text/css" rel="stylesheet" href="css/style.css" />
</head>

<style type="text/css">
/*	img { 
		-webkit-filter: grayscale(0%) blur(1px) invert(10%) opacity(50%) saturate(3%) sepia(100%) ;
	}*/
	.hide {
		visibility: hidden;
	}
	#container {
		position: relative;
		margin-top: 100px;
		margin-left: 100px;
	}
	#edit-box {
		width: 720px;
		height: 540px;
		border: 1px solid #000;
	}
	.pict-box {
		position: relative;
	}
	#stuff-box, #border-box {
		width: 720px;
		height: 540px;
		border: 1px solid #000;
		position: absolute;
		top: 0px;
	}
	#stuff-box img {
		position: absolute;
	}
	.tool-bar {
		width: 720px;
		height: 40px;
		border: 1px solid #000;
	}
	.tool-bar li {
		width: 100px;
		height: 30px;
		float: left;
		margin-right: 20px;
		background: #828D92;
		text-align: center;
		line-height: 30px;
		cursor: pointer;
	}
	.edit-tool {
		width: 720px;
		height: 100px;
		position: absolute;
		bottom: 45px;
		background: #00E1FF;
		display: none;
	}
	.edit-tool p {
		margin-bottom: 5px;
	}
	.edit-tool ul {
		width: 230px;
		height: 100px;
		float: left;
	}
	.edit-tool ul li {
		float: left;
		margin-right: 10px;
		margin-bottom: 5px;
	}
	#filter li, #border li, #stuff li {
		width: 60px;
		height: 30px;
		background: #fff;
		line-height: 30px;
		cursor: pointer;
		text-align: center;
		border-radius: 3px;
		box-shadow: 1px 1px 1px 1px #C5C5C5;
	}
	.edit-tool ul li input[type=button] {
		cursor: pointer;
	}
	#show-img {
		width: 720px;
		height: 540px;
	}
	#merge-pic {
		width: 720px;
		height: 540px;
		border: 1px solid #f00;
	}
	.grayscale {
	  -webkit-filter: grayscale(1);
	}
	.brightness {
	  -webkit-filter: brightness(140%);
	}
	.blur {
	  -webkit-filter: blur(3px);
	}
	.invert {
	  -webkit-filter: invert(100%)
	}
	.opacity {
	  -webkit-filter: opacity(50%)
	}
	.sepia {
	  -webkit-filter: sepia(1);
	}
/*  */
	#drag {
		width: 153px;
		height: 90px;
		position: absolute;
		top: 100px;
		left: 100px;
		border: 2px solid #fff;
	}
/*  */
</style>

<body>
	<div id="container">

		<div class="pict-box">

			<canvas id="edit-box"></canvas>

			<ul class="tool-bar">
				<li id="btn-edit">编辑工具</li>
				<li id="btn-reset">恢复原图</li>
				<li id="btn-export">导出</li>
			</ul>

			<img id="border-box" src="">

			<div id="stuff-box"><div id="drag"><img src="img/stuff_4.png"></div></div>

		</div>

		<div class="edit-tool">
			<ul id="filter" class="filter">
				<p>滤镜</p>
				<li>黑白<input class="hide"value="1"/></li>
				<li>加亮<input class="hide"value="2"/></li>
				<li>模糊<input class="hide"value="3"/></li>
				<li>反色<input class="hide"value="4"/></li>
				<li>淡化<input class="hide"value="5"/></li>
				<li>复古<input class="hide"value="6"/></li>
			</ul>
			<ul id="stuff">
				<p>饰品</p>
				<li>眼泪<input class="hide" value="1"/></li>
				<li>耳朵<input class="hide" value="2"/></li>
				<li>胡子<input class="hide" value="3"/></li>
				<li>弯眼<input class="hide" value="4"/></li>
				<li>猪鼻<input class="hide" value="5"/></li>
				<li>Hello<input class="hide" value="6"/></li>
			</ul>
			<ul id="border">
				<p>边框</p>
				<li>边框1<input class="hide" value="1"/></li>
				<li>边框2<input class="hide" value="2"/></li>
				<li>边框3<input class="hide" value="3"/></li>
				<li>边框4<input class="hide" value="4"/></li>
				<li>边框5<input class="hide" value="5"/></li>
				<li>无<input class="hide" value="0"/></li>
			</ul>
		</div>

	</div>

	<div id="show-img"></div>

	<canvas id="merge-pic"></canvas>

	<img id="test" src="img/stuff_1.png">

</body>
<script type="text/javascript">

function getStyleValue(obj, property) {
	var pro_val = 0;

	if(obj.currentStyle) {
		switch(property) {
			case "left":
				pro_val = obj.currentStyle.left;
				break;
			case "top":
				pro_val = obj.currentStyle.top;
				break;
		}

	} else if(window.getComputedStyle) {
		switch(property) {
			case "left":
				pro_val = window.getComputedStyle(obj, null).left;
				break;
			case "top":
				pro_val = window.getComputedStyle(obj, null).top;
				break;
		}
	}

	return pro_val;
}

function stopPropagation(e) {
  e = window.e || e;
  if(document.all) {
  	e.cancelBubble = true;
  }
  else {
  	e.stopPropagation();
  }
}



window.onload = function() {
	/* create canvas and context objects*/
	canvas = document.getElementById("edit-box");
	ctx = canvas.getContext("2d");

	/* load source image*/

	var imgObj = new Image();

	imgObj.onload = function() {
		ctx.drawImage(this, 0, 0, this.width, this.height, 0, 0, canvas.width, canvas.height);
	}

  imgObj.src = "img/aaaa.jpg";

	var is_drag = false;
	var old_mouse_x = 0;
	var old_mouse_y = 0;
	var old_obj_x;
	var old_obj_y;



  var drag = document.getElementById("drag");
  // var ele = document.getElementById("drag");

  drag.onmousedown = function(ev) {
		// is_drag = true;
		var e = ev || event;
  	// var ele = e.target;


  	// offset_x = e.clientX - drag.offsetLeft;
  	// offset_y = e.clientY - drag.offsetTop;

		old_mouse_x = parseInt(e.clientX);
  	old_mouse_y = parseInt(e.clientY);
  	
  	document.onmouseup = function() {
  		// is_drag = false;
  	  mouseUp();
  	  // e.stopPropagation();
  	}

  	document.onmousemove = function(ev) {
  	  mouseMove(ev);
  	  // e.stopPropagation();
  	}

  	// e.stopPropagation();

  	// 就少了这个  return false
  	return false;
  }

	 // drag.onmouseup = mouseUp;
	 // drag.onmousemove = mouseMove;

	function mouseUp() {
		// var e = window.event || event;
	  document.onmousemove = null;
	  document.onmouseup = null;
	  // console.log("up++");
	  // e.stopPropagation();
	}

	function mouseMove(ev) {
		var e = ev || event;



  	old_obj_x = getStyleValue(drag, "left");
  	old_obj_y = getStyleValue(drag, "top");/*
  	old_obj_x = getStyleValue(e.target, "left");
  	old_obj_y = getStyleValue(e.target, "top");*/
  	old_obj_x = parseInt(old_obj_x);
  	old_obj_y = parseInt(old_obj_y);
		var new_mouse_x = parseInt(e.clientX);
		var new_mouse_y = parseInt(e.clientY);
		console.log("moving");
		var new_obj_x = new_mouse_x - old_mouse_x + old_obj_x;
		var new_obj_y = new_mouse_y - old_mouse_y + old_obj_y;

		// var new_obj_x = e.clientX - offset_x;
		// var new_obj_y = e.clientY - offset_y;

		console.log("1new_mouse_x=" + new_mouse_x);
		// console.log("event.x=" + event.x);
		console.log("2old_mouse_x=" + old_mouse_x);
		console.log("3old_obj_x=" + old_obj_x);
		console.log("4new_obj_x=" + new_obj_x);
		drag.style.left = new_obj_x + "px";
		drag.style.top = new_obj_y + "px";
  	old_mouse_x = new_mouse_x;
  	old_mouse_y = new_mouse_y;
  	// e.stopPropagation();
	}


}


</script>
</html>